// ==UserScript==
// @name         DnDBeyond Campage Share Helper
// @namespace    http://tampermonkey.net/
// @version      1.9
// @description  automatically kicks characters that are inside a campagne for too long
// @author       Linkally
// @match        https://www.dndbeyond.com/campaigns/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=dndbeyond.com
// @updateURL    https://github.com/Linkaly/DnDBeyondShareHelper/raw/main/DnDBeyondShareHelper.user.js
// @downloadURL  https://github.com/Linkaly/DnDBeyondShareHelper/raw/main/DnDBeyondShareHelper.user.js
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==

(function() {
    'use strict';

    let DmNameElements = document.getElementsByClassName("ddb-campaigns-detail-dm-info-name-primary");
    if(DmNameElements.length == 0)
    {
        return;
    }
    let UserNameElements = document.getElementsByClassName("user-interactions-profile-nickname");
    if(UserNameElements.length == 0)
    {
        return;
    }

    if(DmNameElements[0].innerHTML != UserNameElements[0].innerHTML)
    {
        return;
    }

    function insertAfter(referenceNode, newNode) {
        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
    }

    let element = document.getElementsByClassName("ddb-campaigns-detail-body-listing")[0];

    let div1 = document.createElement("div");
    div1.setAttribute("id", "ShareHelper");
    element.insertBefore(div1, element.children[0]);

    let div2 = document.createElement("div");
    div2.setAttribute("class", "line marginTop20 marginBottom20");
    element.insertBefore(div2, element.children[0]);

    var app=function(){"use strict";function e(){}function t(e){return e()}function l(){return Object.create(null)}function n(e){e.forEach(t)}function s(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e){return null==e?"":e}function c(e,t){e.appendChild(t)}function r(e,t,l){e.insertBefore(t,l||null)}function a(e){e.parentNode.removeChild(e)}function u(e,t){for(let l=0;l<e.length;l+=1)e[l]&&e[l].d(t)}function d(e){return document.createElement(e)}function m(e){return document.createTextNode(e)}function f(){return m(" ")}function p(e,t,l,n){return e.addEventListener(t,l,n),()=>e.removeEventListener(t,l,n)}function h(e,t,l){null==l?e.removeAttribute(t):e.getAttribute(t)!==l&&e.setAttribute(t,l)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function g(e,t){e.value=null==t?"":t}function y(e,t,l,n){e.style.setProperty(t,l,n?"important":"")}let k;function w(e){k=e}function b(e){(function(){if(!k)throw new Error("Function called outside component initialization");return k})().$$.on_mount.push(e)}const z=[],x=[],S=[],$=[],C=Promise.resolve();let A=!1;function E(e){S.push(e)}let _=!1;const D=new Set;function I(){if(!_){_=!0;do{for(let e=0;e<z.length;e+=1){const t=z[e];w(t),N(t.$$)}for(z.length=0;x.length;)x.pop()();for(let e=0;e<S.length;e+=1){const t=S[e];D.has(t)||(D.add(t),t())}S.length=0}while(z.length);for(;$.length;)$.pop()();A=!1,_=!1,D.clear()}}function N(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(E)}}const T=new Set;const M="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function B(e,t){-1===e.$$.dirty[0]&&(z.push(e),A||(A=!0,C.then(I)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function L(o,i,c,r,u,d,m=[-1]){const f=k;w(o);const p=i.props||{},h=o.$$={fragment:null,ctx:null,props:d,update:e,not_equal:u,bound:l(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:l(),dirty:m,skip_bound:!1};let v=!1;if(h.ctx=c?c(o,p,(e,t,...l)=>{const n=l.length?l[0]:t;return h.ctx&&u(h.ctx[e],h.ctx[e]=n)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](n),v&&B(o,e)),t}):[],h.update(),v=!0,n(h.before_update),h.fragment=!!r&&r(h.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);h.fragment&&h.fragment.l(e),e.forEach(a)}else h.fragment&&h.fragment.c();i.intro&&((g=o.$$.fragment)&&g.i&&(T.delete(g),g.i(y))),function(e,l,o){const{fragment:i,on_mount:c,on_destroy:r,after_update:a}=e.$$;i&&i.m(l,o),E(()=>{const l=c.map(t).filter(s);r?r.push(...l):n(l),e.$$.on_mount=[]}),a.forEach(E)}(o,i.target,i.anchor),I()}var g,y;w(f)}const{document:J}=M;function R(e,t,l){const n=e.slice();return n[47]=t[l],n[49]=l,n}function H(e,t,l){const n=e.slice();return n[50]=t[l],n[49]=l,n}function O(e,t,l){const n=e.slice();return n[50]=t[l],n[49]=l,n}function j(e){let t,l,n,s,o,u,g,y=e[50]+"";function k(...t){return e[21](e[50],...t)}return{c(){t=d("tr"),l=d("td"),n=m(y),o=f(),h(l,"class",s=i(e[5]==e[50]?"selectedRow":"")+" svelte-mlzco"),h(t,"class","svelte-mlzco")},m(e,s){r(e,t,s),c(t,l),c(l,n),c(t,o),u||(g=p(l,"click",k),u=!0)},p(t,o){e=t,1&o[0]&&y!==(y=e[50]+"")&&v(n,y),33&o[0]&&s!==(s=i(e[5]==e[50]?"selectedRow":"")+" svelte-mlzco")&&h(l,"class",s)},d(e){e&&a(t),u=!1,g()}}}function G(e){let t,l,n,s,o,u,g,y=e[50]+"";function k(...t){return e[24](e[50],...t)}return{c(){t=d("tr"),l=d("td"),n=m(y),o=f(),h(l,"class",s=i(e[6]==e[50]?"selectedRow":"")+" svelte-mlzco"),h(t,"class","svelte-mlzco")},m(e,s){r(e,t,s),c(t,l),c(l,n),c(t,o),u||(g=p(l,"click",k),u=!0)},p(t,o){e=t,1&o[0]&&y!==(y=e[50]+"")&&v(n,y),65&o[0]&&s!==(s=i(e[6]==e[50]?"selectedRow":"")+" svelte-mlzco")&&h(l,"class",s)},d(e){e&&a(t),u=!1,g()}}}function V(e){let t,l,n,s,o,i,u,p=e[47].timesSeen+"",g=e[47].name+"";return{c(){t=d("tr"),l=d("td"),n=m(p),s=f(),o=d("td"),i=m(g),u=f(),h(l,"class","svelte-mlzco"),h(o,"class","svelte-mlzco"),h(t,"class","svelte-mlzco")},m(e,a){r(e,t,a),c(t,l),c(l,n),c(t,s),c(t,o),c(o,i),c(t,u)},p(e,t){1&t[0]&&p!==(p=e[47].timesSeen+"")&&v(n,p),1&t[0]&&g!==(g=e[47].name+"")&&v(i,g)},d(e){e&&a(t)}}}function q(e){let t,l,n,s,o,i,u,p=e[47].timesSeen+"",g=e[47].name+"";return{c(){t=d("tr"),l=d("td"),n=m(p),s=f(),o=d("td"),i=m(g),u=f(),h(l,"class","svelte-mlzco"),h(o,"class","svelte-mlzco"),y(t,"background-color","aqua"),h(t,"class","svelte-mlzco")},m(e,a){r(e,t,a),c(t,l),c(l,n),c(t,s),c(t,o),c(o,i),c(t,u)},p(e,t){1&t[0]&&p!==(p=e[47].timesSeen+"")&&v(n,p),1&t[0]&&g!==(g=e[47].name+"")&&v(i,g)},d(e){e&&a(t)}}}function K(e){let t;function l(e,t){return null!==e[47].currentlyJoinedSince?q:V}let n=l(e),s=n(e);return{c(){s.c(),t=m("")},m(e,l){s.m(e,l),r(e,t,l)},p(e,o){n===(n=l(e))&&s?s.p(e,o):(s.d(1),s=n(e),s&&(s.c(),s.m(t.parentNode,t)))},d(e){s.d(e),e&&a(t)}}}function P(t){let l,s,o,i,k,w,b,z,x,S,$,C,A,E,_,D,I,N,T,M,B,L,V,q,P,W,F,Q,X,Y,Z,ee,te,le,ne,se,oe,ie,ce,re,ae,ue,de,me,fe,pe,he,ve,ge,ye,ke,we,be,ze,xe,Se,$e,Ce,Ae,Ee,_e,De,Ie,Ne,Te,Me,Be,Le,Je,Re,He,Oe,je,Ge,Ve,qe,Ke,Pe,Ue=t[0].enabled?"Enabled":"Disabled",We=t[0].whitelist,Fe=[];for(let e=0;e<We.length;e+=1)Fe[e]=j(O(t,We,e));let Qe=t[0].blacklist,Xe=[];for(let e=0;e<Qe.length;e+=1)Xe[e]=G(H(t,Qe,e));let Ye=t[0].players,Ze=[];for(let e=0;e<Ye.length;e+=1)Ze[e]=K(R(t,Ye,e));return{c(){l=d("link"),s=f(),o=d("div"),i=d("div"),i.innerHTML='<div class="col pb-4 pt-2 svelte-mlzco"><h1 style="font-size: xx-large; text-align: center;" class="svelte-mlzco">DnD Beyond Sharing Helper</h1></div>',k=f(),w=d("div"),b=d("div"),z=d("div"),x=m("Status: \n        "),S=d("button"),$=m(Ue),C=f(),A=d("div"),E=d("div"),_=d("p"),_.textContent="Whitelist:",D=f(),I=d("input"),N=f(),T=d("p"),T.textContent="slots",M=f(),B=d("div"),L=d("p"),L.textContent="Reload after:",V=f(),q=d("input"),P=f(),W=d("p"),W.textContent="minutes",F=f(),Q=d("div"),X=d("p"),X.textContent="Kick after:",Y=f(),Z=d("input"),ee=f(),te=d("p"),te.textContent="minutes",le=f(),ne=d("div"),se=d("p"),se.textContent="Kick after:",oe=f(),ie=d("input"),ce=f(),re=d("p"),re.textContent="days seen",ae=f(),ue=d("div"),de=d("table"),me=d("thead"),me.innerHTML='<tr class="svelte-mlzco"><th class="svelte-mlzco">Whitelist</th></tr>',fe=f(),pe=d("tbody");for(let e=0;e<Fe.length;e+=1)Fe[e].c();he=f(),ve=d("div"),ge=d("input"),ye=f(),ke=d("button"),ke.textContent="Add",we=f(),be=d("button"),be.textContent="Remove",ze=f(),xe=d("div"),Se=d("table"),$e=d("thead"),$e.innerHTML='<tr class="svelte-mlzco"><th class="svelte-mlzco">Blacklist</th></tr>',Ce=f(),Ae=d("tbody");for(let e=0;e<Xe.length;e+=1)Xe[e].c();Ee=f(),_e=d("div"),De=d("input"),Ie=f(),Ne=d("button"),Ne.textContent="Add",Te=f(),Me=d("button"),Me.textContent="Remove",Be=f(),Le=d("div"),Je=d("table"),Re=d("thead"),He=d("tr"),Oe=d("th"),Oe.textContent="Days seen",je=f(),Ge=d("th"),Ge.textContent="Name",Ve=f(),qe=d("tbody");for(let e=0;e<Ze.length;e+=1)Ze[e].c();h(l,"href","https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap-grid.min.css"),h(l,"rel","stylesheet"),h(l,"crossorigin","anonymous"),h(l,"class","svelte-mlzco"),h(i,"class","row svelte-mlzco"),h(S,"class","svelte-mlzco"),h(z,"class","svelte-mlzco"),h(_,"class","col-5 svelte-mlzco"),h(I,"class","col-3 svelte-mlzco"),y(I,"padding","2px"),y(I,"height","18px"),y(I,"width","64px"),h(I,"type","text"),h(I,"min","0"),h(T,"class","col-4 svelte-mlzco"),h(E,"class","row pt-2 svelte-mlzco"),h(L,"class","col-5 svelte-mlzco"),h(q,"class","col-3 svelte-mlzco"),y(q,"padding","2px"),y(q,"height","18px"),y(q,"width","64px"),h(q,"type","text"),h(q,"min","0"),h(W,"class","col-4 svelte-mlzco"),h(B,"class","row py-0 svelte-mlzco"),h(X,"class","col-4 svelte-mlzco"),h(Z,"class","col-3 svelte-mlzco"),y(Z,"padding","2px"),y(Z,"height","18px"),y(Z,"width","64px"),h(Z,"type","text"),h(Z,"min","0"),h(te,"class","col-5 svelte-mlzco"),h(Q,"class","row py-0 svelte-mlzco"),h(se,"class","col-4 svelte-mlzco"),h(ie,"class","col-3 svelte-mlzco"),y(ie,"padding","2px"),y(ie,"height","18px"),y(ie,"width","64px"),h(ie,"type","text"),h(ie,"min","0"),h(re,"class","col-5 svelte-mlzco"),h(ne,"class","row py-0 svelte-mlzco"),h(A,"class","container-fluid px-0 svelte-mlzco"),h(b,"class","col svelte-mlzco"),h(me,"class","svelte-mlzco"),h(pe,"class","svelte-mlzco"),y(de,"width","90%"),h(de,"class","svelte-mlzco"),y(ge,"width","10px"),y(ge,"flex","auto"),h(ge,"type","text"),h(ge,"class","svelte-mlzco"),h(ke,"class","svelte-mlzco"),h(be,"class","svelte-mlzco"),y(ve,"margin-top","10px"),y(ve,"width","90%"),y(ve,"display","flex"),y(ve,"flex-direction","row"),h(ve,"class","svelte-mlzco"),h(ue,"class","col svelte-mlzco"),h($e,"class","svelte-mlzco"),h(Ae,"class","svelte-mlzco"),y(Se,"width","90%"),h(Se,"class","svelte-mlzco"),y(De,"width","10px"),y(De,"flex","auto"),h(De,"type","text"),h(De,"class","svelte-mlzco"),h(Ne,"class","svelte-mlzco"),h(Me,"class","svelte-mlzco"),y(_e,"margin-top","10px"),y(_e,"width","90%"),y(_e,"display","flex"),y(_e,"flex-direction","row"),h(_e,"class","svelte-mlzco"),h(xe,"class","col svelte-mlzco"),y(Oe,"width","30%"),h(Oe,"class","svelte-mlzco"),h(Ge,"class","svelte-mlzco"),h(He,"class","svelte-mlzco"),h(Re,"class","svelte-mlzco"),h(qe,"class","svelte-mlzco"),y(Je,"width","100%"),h(Je,"class","svelte-mlzco"),h(Le,"class","col svelte-mlzco"),y(Le,"max-height","400px"),y(Le,"overflow-y","auto"),h(w,"class","row svelte-mlzco"),h(o,"class","container-fluid svelte-mlzco")},m(e,n){c(J.head,l),r(e,s,n),r(e,o,n),c(o,i),c(o,k),c(o,w),c(w,b),c(b,z),c(z,x),c(z,S),c(S,$),c(b,C),c(b,A),c(A,E),c(E,_),c(E,D),c(E,I),g(I,t[1]),c(E,N),c(E,T),c(A,M),c(A,B),c(B,L),c(B,V),c(B,q),g(q,t[2]),c(B,P),c(B,W),c(A,F),c(A,Q),c(Q,X),c(Q,Y),c(Q,Z),g(Z,t[3]),c(Q,ee),c(Q,te),c(A,le),c(A,ne),c(ne,se),c(ne,oe),c(ne,ie),g(ie,t[4]),c(ne,ce),c(ne,re),c(w,ae),c(w,ue),c(ue,de),c(de,me),c(de,fe),c(de,pe);for(let e=0;e<Fe.length;e+=1)Fe[e].m(pe,null);c(ue,he),c(ue,ve),c(ve,ge),g(ge,t[5]),c(ve,ye),c(ve,ke),c(ve,we),c(ve,be),c(w,ze),c(w,xe),c(xe,Se),c(Se,$e),c(Se,Ce),c(Se,Ae);for(let e=0;e<Xe.length;e+=1)Xe[e].m(Ae,null);c(xe,Ee),c(xe,_e),c(_e,De),g(De,t[6]),c(_e,Ie),c(_e,Ne),c(_e,Te),c(_e,Me),c(w,Be),c(w,Le),c(Le,Je),c(Je,Re),c(Re,He),c(He,Oe),c(He,je),c(He,Ge),c(Je,Ve),c(Je,qe);for(let e=0;e<Ze.length;e+=1)Ze[e].m(qe,null);Ke||(Pe=[p(S,"click",t[16]),p(I,"blur",t[7]),p(I,"keyup",U),p(I,"input",t[17]),p(q,"blur",t[8]),p(q,"keyup",U),p(q,"input",t[18]),p(Z,"blur",t[9]),p(Z,"keyup",U),p(Z,"input",t[19]),p(ie,"blur",t[10]),p(ie,"keyup",U),p(ie,"input",t[20]),p(ge,"keyup",t[22]),p(ge,"input",t[23]),p(ke,"click",t[11]),p(be,"click",t[12]),p(De,"keyup",t[25]),p(De,"input",t[26]),p(Ne,"click",t[13]),p(Me,"click",t[14]),p(Oe,"click",t[27]),p(Ge,"click",t[28])],Ke=!0)},p(e,t){if(1&t[0]&&Ue!==(Ue=e[0].enabled?"Enabled":"Disabled")&&v($,Ue),2&t[0]&&I.value!==e[1]&&g(I,e[1]),4&t[0]&&q.value!==e[2]&&g(q,e[2]),8&t[0]&&Z.value!==e[3]&&g(Z,e[3]),16&t[0]&&ie.value!==e[4]&&g(ie,e[4]),33&t[0]){let l;for(We=e[0].whitelist,l=0;l<We.length;l+=1){const n=O(e,We,l);Fe[l]?Fe[l].p(n,t):(Fe[l]=j(n),Fe[l].c(),Fe[l].m(pe,null))}for(;l<Fe.length;l+=1)Fe[l].d(1);Fe.length=We.length}if(32&t[0]&&ge.value!==e[5]&&g(ge,e[5]),65&t[0]){let l;for(Qe=e[0].blacklist,l=0;l<Qe.length;l+=1){const n=H(e,Qe,l);Xe[l]?Xe[l].p(n,t):(Xe[l]=G(n),Xe[l].c(),Xe[l].m(Ae,null))}for(;l<Xe.length;l+=1)Xe[l].d(1);Xe.length=Qe.length}if(64&t[0]&&De.value!==e[6]&&g(De,e[6]),1&t[0]){let l;for(Ye=e[0].players,l=0;l<Ye.length;l+=1){const n=R(e,Ye,l);Ze[l]?Ze[l].p(n,t):(Ze[l]=K(n),Ze[l].c(),Ze[l].m(qe,null))}for(;l<Ze.length;l+=1)Ze[l].d(1);Ze.length=Ye.length}},i:e,o:e,d(e){a(l),e&&a(s),e&&a(o),u(Fe,e),u(Xe,e),u(Ze,e),Ke=!1,n(Pe)}}}function U(e){"Enter"==e.key&&e.target.blur()}function W(e,t,l){class n{constructor(){this.timesSeen=0,this.currentlyJoinedSince=null,this.timestampDaysSeen=null}}class s{constructor(){this.version=1.9,this.enabled=!1,this.players=[],this.whitelist=[],this.blacklist=[],this.whitelistSlots=0,this.kickAfterMinutes=60,this.kickAfterTimesSeen=0,this.updateInterval=0}}let o=null,i=function(){return window.location.href.split("/")[4]};if("undefined"!=typeof GM_getValue){let e=GM_getValue(i(),"");if(""!=e){let t=JSON.parse(e);null!=t&&null!=t.version&&t.version>=1.2&&(o=t)}}null==o&&(o=new s);let c=new s;o.version<1.8&&(o.kickAfterTimesSeen=c.kickAfterTimesSeen),o.version<c.version&&(o.version=c.version);let r=function(e){let t=[];for(let l=0;l<e.length;l++){let n=e[l];"Unassigned"!=n&&t.push(n.split(": ")[1])}return t=[...new Set(t)],t},a=!1,u=function(e){if(0==a){a=!0;let t=document.getElementsByClassName("ddb-campaigns-character-card"),l=null,n=t[e].getElementsByClassName("ddb-campaigns-character-card-footer-links-item-remove");n.length>0?l=n[0]:(n=t[e].getElementsByClassName("ddb-campaigns-character-card-footer-links-item-more-remove"),n.length>0&&(l=n[0])),null!=l?l.click():console.error("DnD Beyond Share Helper: could not find the remove button for card "+e);let s=function(){let e=document.getElementsByClassName("ajax-post");e.length>0?e[0].click():setTimeout(s,500)};setTimeout(s,500)}},d=function(e,t){let l=t[e].split(": ");l.length>=2&&(o.whitelist.includes(l[1])||u(e))},m=o.whitelistSlots;let f=o.updateInterval;let p=o.kickAfterMinutes;let h=o.kickAfterTimesSeen;let v="",g=function(){let e=v.replace("/s/g","");""!==e&&(o.whitelist.push(e),o.whitelist.sort(),l(0,o.whitelist=[...new Set(o.whitelist)],o),l(5,v=""))},y="",k=function(){let e=y.replace("/s/g","");""!==e&&(o.blacklist.push(e),o.blacklist.sort(),l(0,o.blacklist=[...new Set(o.blacklist)],o),l(6,y=""))},w="",z=function(e,t){return e<t?-1:e>t?1:0},x=function(e){"days"==e?"daysD"==w?(o.players.sort((function(e,t){return z(e.timesSeen,t.timesSeen)})),w="daysA"):(o.players.sort((function(e,t){return z(t.timesSeen,e.timesSeen)})),w="daysD"):"name"==e&&("nameA"==w?(o.players.sort((function(e,t){return z(t.name.toLowerCase(),e.name.toLowerCase())})),w="nameD"):(o.players.sort((function(e,t){return z(e.name.toLowerCase(),t.name.toLowerCase())})),w="nameA")),l(0,o)};b(()=>{let e=function(){let e=document.getElementsByClassName("ddb-campaigns-character-card"),t=[];for(let l=0;l<e.length;l++){let n=e[l].getElementsByClassName("ddb-campaigns-character-card-header-upper-character-info-secondary")[1].innerHTML;t.push(n)}return t}();!function(e){for(let t=0;t<e.length;++t){if(o.players.findIndex(l=>l.name==e[t])<0){let l=new n;l.timesSeen=1,l.currentlyJoinedSince=Date.now(),l.timestampDaysSeen=Date.now(),l.name=e[t],o.players.push(l)}}for(let t=0;t<o.players.length;++t)e.includes(o.players[t].name)?(Date.now()-o.players[t].timestampDaysSeen>828e5&&(l(0,o.players[t].timestampDaysSeen=Date.now(),o),l(0,o.players[t].timesSeen=o.players[t].timesSeen+1,o)),null===o.players[t].currentlyJoinedSince&&l(0,o.players[t].currentlyJoinedSince=Date.now(),o)):l(0,o.players[t].currentlyJoinedSince=null,o);l(0,o)}(r(e)),o.enabled&&(function(e){if(1!=a)for(let t=0;t<e.length;++t)if("Unassigned"==e[t]&&(u(t),a=!!a,1==a))return}(e),function(e){if(1!=a)for(let t=0;t<e.length;++t){let l=e[t].split(": ");if(l.length>=2&&o.blacklist.includes(l[1])&&(d(t,e),a=!!a,1==a))return}}(e),function(e){if(!(1==a||o.kickAfterTimesSeen<=0))for(let t=0;t<e.length;++t){let l=e[t].split(": ");if(l.length>=2){let n=o.players.findIndex(e=>e.name==l[1]);if(n>=0&&o.players[n].timesSeen>=o.kickAfterTimesSeen&&(d(t,e),a=!!a,1==a))return}}}(e),function(e){if(!(1==a||o.kickAfterMinutes<=0))for(let t=0;t<e.length;++t){let l=e[t].split(": ");if(l.length>=2){let n=o.players.findIndex(e=>e.name==l[1]);if(n>=0&&Date.now()-o.players[n].currentlyJoinedSince>60*o.kickAfterMinutes*1e3&&(d(t,e),a=!!a,1==a))return}}}(e),function(e){if(1!=a)for(let t=0;t<e.length;++t)if(new Set(r(e)).size+o.whitelistSlots>12&&(d(t,e),a=!!a,1==a))return}(e)),x("name"),x("days");let t=Date.now();const s=setInterval(()=>{1==o.enabled&&o.updateInterval>0&&Date.now()>t+60*o.updateInterval*1e3&&location.reload()},1e4);return window.addEventListener("beforeunload",e=>{"activeElement"in document&&document.activeElement.blur(),"undefined"!=typeof GM_setValue&&GM_setValue(i(),JSON.stringify(o))}),()=>{clearInterval(s)}});return[o,m,f,p,h,v,y,function(e){let t=e.target;l(1,m=null===t.value||m<parseInt(t.min)?o.whitelistSlots:parseInt(t.value)),isNaN(m)||l(0,o.whitelistSlots=m,o),l(1,m=o.whitelistSlots)},function(e){let t=e.target;l(2,f=null===t.value||f<parseInt(t.min)?o.updateInterval:parseInt(t.value)),isNaN(f)||l(0,o.updateInterval=f,o),l(2,f=o.updateInterval)},function(e){let t=e.target;l(3,p=null===t.value||p<parseInt(t.min)?o.kickAfterMinutes:parseInt(t.value)),isNaN(p)||l(0,o.kickAfterMinutes=p,o),l(3,p=o.kickAfterMinutes)},function(e){let t=e.target;l(4,h=null===t.value||h<parseInt(t.min)?o.kickAfterTimesSeen:parseInt(t.value)),isNaN(h)||l(0,o.kickAfterTimesSeen=h,o),l(4,h=o.kickAfterTimesSeen)},g,function(){if(""!==v.replace("/s/g","")){const e=o.whitelist.indexOf(v);e>-1&&o.whitelist.splice(e,1),o.whitelist.sort(),l(0,o.whitelist=[...new Set(o.whitelist)],o),l(5,v="")}},k,function(){if(""!==y.replace("/s/g","")){const e=o.blacklist.indexOf(y);e>-1&&o.blacklist.splice(e,1),o.blacklist.sort(),l(0,o.blacklist=[...new Set(o.blacklist)],o),l(6,y="")}},x,e=>l(0,o.enabled=!o.enabled,o),function(){m=this.value,l(1,m)},function(){f=this.value,l(2,f)},function(){p=this.value,l(3,p)},function(){h=this.value,l(4,h)},(e,t)=>l(5,v=e),e=>{"Enter"==e.key&&g()},function(){v=this.value,l(5,v)},(e,t)=>l(6,y=e),e=>{"Enter"==e.key&&k()},function(){y=this.value,l(6,y)},e=>x("days"),e=>x("name")]}return new class extends class{$destroy(){!function(e,t){const l=e.$$;null!==l.fragment&&(n(l.on_destroy),l.fragment&&l.fragment.d(t),l.on_destroy=l.fragment=null,l.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(t),()=>{const e=l.indexOf(t);-1!==e&&l.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){var t;super(),J.getElementById("svelte-mlzco-style")||((t=d("style")).id="svelte-mlzco-style",t.textContent="table.svelte-mlzco,th.svelte-mlzco,td.svelte-mlzco{border:1px solid black;border-collapse:collapse}table.svelte-mlzco{background:#eee;width:50%;text-align:left}.selectedRow.svelte-mlzco{background:rgb(138, 255, 92)}.svelte-mlzco{font-size:medium}",c(J.head,t)),L(this,e,W,P,o,{},[-1,-1])}}({target:document.getElementById("ShareHelper")})}();

})();